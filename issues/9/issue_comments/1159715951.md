---
author_association: OWNER
created_at: '2022-06-19T12:42:40Z'
html_url: https://github.com/ima1zumi/stunning-bassoon/issues/9#issuecomment-1159715951
id: 1159715951
issue_url: https://api.github.com/repos/ima1zumi/stunning-bassoon/issues/9
node_id: IC_kwDOHe_Pp85FH9xv
performed_via_github_app: 
reactions:
  "+1": 0
  "-1": 0
  confused: 0
  eyes: 0
  heart: 0
  hooray: 0
  laugh: 0
  rocket: 0
  total_count: 0
  url: https://api.github.com/repos/ima1zumi/stunning-bassoon/issues/comments/1159715951/reactions
updated_at: '2022-06-19T12:46:06Z'
url: https://api.github.com/repos/ima1zumi/stunning-bassoon/issues/comments/1159715951
user:
  avatar_url: https://avatars.githubusercontent.com/u/52617472?v=4
  events_url: https://api.github.com/users/ima1zumi/events{/privacy}
  followers_url: https://api.github.com/users/ima1zumi/followers
  following_url: https://api.github.com/users/ima1zumi/following{/other_user}
  gists_url: https://api.github.com/users/ima1zumi/gists{/gist_id}
  gravatar_id: ''
  html_url: https://github.com/ima1zumi
  id: 52617472
  login: ima1zumi
  node_id: MDQ6VXNlcjUyNjE3NDcy
  organizations_url: https://api.github.com/users/ima1zumi/orgs
  received_events_url: https://api.github.com/users/ima1zumi/received_events
  repos_url: https://api.github.com/users/ima1zumi/repos
  site_admin: false
  starred_url: https://api.github.com/users/ima1zumi/starred{/owner}{/repo}
  subscriptions_url: https://api.github.com/users/ima1zumi/subscriptions
  type: User
  url: https://api.github.com/users/ima1zumi

---
UTF-8ならマルチバイトでも全然平気ですわ〜


```
vagrant@ubuntu-bionic:~$ sudo perf record -g ~/workdir/install_optimized/bin/ruby-optimized -e 'GC.disable; str = "あああああ,"*373623; str.split(",", -1)'
[ perf record: Woken up 1 times to write data ]
[ perf record: Captured and wrote 0.088 MB perf.data (169 samples) ]


Samples: 169  of event 'cpu-clock', Event count (approx.): 42250000
  Overhead  Command         Shared Object      Symbol
+    2.37%  ruby-optimized  ruby-optimized     [.] ruby_sip_hash13
+    1.78%  ruby-optimized  ruby-optimized     [.] RVALUE_OLD_P_RAW
+    1.78%  ruby-optimized  ruby-optimized     [.] rb_enc_get_index
+    1.18%  ruby-optimized  libc-2.27.so       [.] __memcpy_avx_unaligned_erms
+    1.18%  ruby-optimized  libc-2.27.so       [.] malloc_usable_size
+    1.18%  ruby-optimized  ruby-optimized     [.] RBASIC_CLASS
+    1.18%  ruby-optimized  ruby-optimized     [.] RB_BUILTIN_TYPE
+    1.18%  ruby-optimized  ruby-optimized     [.] RB_ENCODING_GET
+    1.18%  ruby-optimized  ruby-optimized     [.] RB_OBJ_FREEZE_RAW
+    1.18%  ruby-optimized  ruby-optimized     [.] RB_SPECIAL_CONST_P
+    1.18%  ruby-optimized  ruby-optimized     [.] RB_TYPE_P
+    1.18%  ruby-optimized  ruby-optimized     [.] RSTRING_PTR
+    1.18%  ruby-optimized  ruby-optimized     [.] any_hash
+    1.18%  ruby-optimized  ruby-optimized     [.] gc_aging
+    1.18%  ruby-optimized  ruby-optimized     [.] get_bins_num
+    1.18%  ruby-optimized  ruby-optimized     [.] heap_page_add_freeobj
+    1.18%  ruby-optimized  ruby-optimized     [.] iseq_extract_values
+    1.18%  ruby-optimized  ruby-optimized     [.] magic_comment_marker
+    1.18%  ruby-optimized  ruby-optimized     [.] newobj_fill
+    1.18%  ruby-optimized  ruby-optimized     [.] ractor_cache_allocate_slot
+    1.18%  ruby-optimized  ruby-optimized     [.] rb_enc_cr_str_copy_for_substr
+    1.18%  ruby-optimized  ruby-optimized     [.] rb_iseq_mark
+    1.18%  ruby-optimized  ruby-optimized     [.] rbimpl_fl_unset_raw_raw
+    1.18%  ruby-optimized  ruby-optimized     [.] rbimpl_rstring_getmem
+    1.18%  ruby-optimized  ruby-optimized     [.] tokadd_mbchar
+    1.18%  ruby-optimized  ruby-optimized     [.] vm_exec_core
+    0.59%  ruby-optimized  [kernel.kallsyms]  [k] __do_page_fault
+    0.59%  ruby-optimized  [kernel.kallsyms]  [k] __handle_mm_fault
+    0.59%  ruby-optimized  [kernel.kallsyms]  [k] __inode_permission
+    0.59%  ruby-optimized  [kernel.kallsyms]  [k] __softirqentry_text_start
+    0.59%  ruby-optimized  [kernel.kallsyms]  [k] clear_page_rep
+    0.59%  ruby-optimized  [kernel.kallsyms]  [k] get_page_from_freelist
+    0.59%  ruby-optimized  [kernel.kallsyms]  [k] link_path_walk
+    0.59%  ruby-optimized  [kernel.kallsyms]  [k] pagevec_lru_move_fn
+    0.59%  ruby-optimized  [kernel.kallsyms]  [k] perf_iterate_sb
+    0.59%  ruby-optimized  [kernel.kallsyms]  [k] process_measurement
+    0.59%  ruby-optimized  [kernel.kallsyms]  [k] security_file_alloc
+    0.59%  ruby-optimized  ld-2.27.so         [.] do_lookup_x
+    0.59%  ruby-optimized  libc-2.27.so       [.] __GI_____strtoul_l_internal
```