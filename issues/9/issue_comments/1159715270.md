---
author_association: OWNER
created_at: '2022-06-19T12:39:48Z'
html_url: https://github.com/ima1zumi/stunning-bassoon/issues/9#issuecomment-1159715270
id: 1159715270
issue_url: https://api.github.com/repos/ima1zumi/stunning-bassoon/issues/9
node_id: IC_kwDOHe_Pp85FH9nG
performed_via_github_app: 
reactions:
  "+1": 0
  "-1": 0
  confused: 0
  eyes: 0
  heart: 0
  hooray: 0
  laugh: 0
  rocket: 0
  total_count: 0
  url: https://api.github.com/repos/ima1zumi/stunning-bassoon/issues/comments/1159715270/reactions
updated_at: '2022-06-19T12:41:34Z'
url: https://api.github.com/repos/ima1zumi/stunning-bassoon/issues/comments/1159715270
user:
  avatar_url: https://avatars.githubusercontent.com/u/52617472?v=4
  events_url: https://api.github.com/users/ima1zumi/events{/privacy}
  followers_url: https://api.github.com/users/ima1zumi/followers
  following_url: https://api.github.com/users/ima1zumi/following{/other_user}
  gists_url: https://api.github.com/users/ima1zumi/gists{/gist_id}
  gravatar_id: ''
  html_url: https://github.com/ima1zumi
  id: 52617472
  login: ima1zumi
  node_id: MDQ6VXNlcjUyNjE3NDcy
  organizations_url: https://api.github.com/users/ima1zumi/orgs
  received_events_url: https://api.github.com/users/ima1zumi/received_events
  repos_url: https://api.github.com/users/ima1zumi/repos
  site_admin: false
  starred_url: https://api.github.com/users/ima1zumi/starred{/owner}{/repo}
  subscriptions_url: https://api.github.com/users/ima1zumi/subscriptions
  type: User
  url: https://api.github.com/users/ima1zumi

---
ASCII only (UTF-8)

373623はKEN_ALL.CSVの文字数1868115を5で割った数

```bash
vagrant@ubuntu-bionic:~$ sudo perf record -g ~/workdir/install_optimized/bin/ruby-optimized -e 'GC.disable; str = "aaaaa,"*373623; str.split(",", -1)'
[ perf record: Woken up 1 times to write data ]
[ perf record: Captured and wrote 0.060 MB perf.data (132 samples) ]
```

```bash
Samples: 132  of event 'cpu-clock', Event count (approx.): 33000000
  Overhead  Command         Shared Object      Symbol
+    4.55%  ruby-optimized  ruby-optimized     [.] ruby_yyparse
+    3.03%  ruby-optimized  [kernel.kallsyms]  [k] get_page_from_freelist
+    2.27%  ruby-optimized  [kernel.kallsyms]  [k] __do_page_fault
+    2.27%  ruby-optimized  [kernel.kallsyms]  [k] __softirqentry_text_start
+    2.27%  ruby-optimized  ruby-optimized     [.] RB_IMMEDIATE_P
+    2.27%  ruby-optimized  ruby-optimized     [.] ruby_sip_hash13
+    1.52%  ruby-optimized  libc-2.27.so       [.] __memcpy_avx_unaligned_erms
+    1.52%  ruby-optimized  ruby-optimized     [.] RB_FL_ANY_RAW
+    1.52%  ruby-optimized  ruby-optimized     [.] RB_FL_TEST_RAW
+    1.52%  ruby-optimized  ruby-optimized     [.] RB_SPECIAL_CONST_P
+    1.52%  ruby-optimized  ruby-optimized     [.] RB_TEST
+    1.52%  ruby-optimized  ruby-optimized     [.] RB_TYPE_P
+    1.52%  ruby-optimized  ruby-optimized     [.] RSTRING_LEN
+    1.52%  ruby-optimized  ruby-optimized     [.] RSTRING_PTR
+    1.52%  ruby-optimized  ruby-optimized     [.] RVALUE_OLD_P_RAW
+    1.52%  ruby-optimized  ruby-optimized     [.] gc_sweep
+    1.52%  ruby-optimized  ruby-optimized     [.] invoke_block_from_c_bh
+    1.52%  ruby-optimized  ruby-optimized     [.] is_identchar
+    1.52%  ruby-optimized  ruby-optimized     [.] newobj_of
+    1.52%  ruby-optimized  ruby-optimized     [.] newobj_of0
+    1.52%  ruby-optimized  ruby-optimized     [.] onigenc_unicode_is_code_ctype
+    1.52%  ruby-optimized  ruby-optimized     [.] ractor_cache_allocate_slot
+    1.52%  ruby-optimized  ruby-optimized     [.] rb_enc_cr_str_copy_for_substr
+    1.52%  ruby-optimized  ruby-optimized     [.] rbimpl_rstring_getmem
+    1.52%  ruby-optimized  ruby-optimized     [.] split_string
+    1.52%  ruby-optimized  ruby-optimized     [.] str_alloc
+    0.76%  ruby-optimized  [kernel.kallsyms]  [k] __radix_tree_lookup
+    0.76%  ruby-optimized  [kernel.kallsyms]  [k] _raw_spin_unlock_irqrestore
+    0.76%  ruby-optimized  [kernel.kallsyms]  [k] clear_page_rep
+    0.76%  ruby-optimized  [kernel.kallsyms]  [k] common_perm_cond
+    0.76%  ruby-optimized  [kernel.kallsyms]  [k] do_syscall_64
+    0.76%  ruby-optimized  libc-2.27.so       [.] _int_malloc
+    0.76%  ruby-optimized  libc-2.27.so       [.] msort_with_tmp.part.0
+    0.76%  ruby-optimized  ruby-optimized     [.] RB_BUILTIN_TYPE
+    0.76%  ruby-optimized  ruby-optimized     [.] RB_ENCODING_GET
+    0.76%  ruby-optimized  ruby-optimized     [.] RB_ENC_CODERANGE
+    0.76%  ruby-optimized  ruby-optimized     [.] RB_FL_ANY_RAW
+    0.76%  ruby-optimized  ruby-optimized     [.] RB_FL_ANY_RAW
+    0.76%  ruby-optimized  ruby-optimized     [.] RB_FL_TEST_RAW
```

encodingがボトルネックになってませんわよ