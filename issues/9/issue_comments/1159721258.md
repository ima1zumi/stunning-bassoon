---
author_association: OWNER
created_at: '2022-06-19T13:04:39Z'
html_url: https://github.com/ima1zumi/stunning-bassoon/issues/9#issuecomment-1159721258
id: 1159721258
issue_url: https://api.github.com/repos/ima1zumi/stunning-bassoon/issues/9
node_id: IC_kwDOHe_Pp85FH_Eq
performed_via_github_app: 
reactions:
  "+1": 0
  "-1": 0
  confused: 0
  eyes: 0
  heart: 0
  hooray: 0
  laugh: 0
  rocket: 0
  total_count: 0
  url: https://api.github.com/repos/ima1zumi/stunning-bassoon/issues/comments/1159721258/reactions
updated_at: '2022-06-19T13:06:29Z'
url: https://api.github.com/repos/ima1zumi/stunning-bassoon/issues/comments/1159721258
user:
  avatar_url: https://avatars.githubusercontent.com/u/52617472?v=4
  events_url: https://api.github.com/users/ima1zumi/events{/privacy}
  followers_url: https://api.github.com/users/ima1zumi/followers
  following_url: https://api.github.com/users/ima1zumi/following{/other_user}
  gists_url: https://api.github.com/users/ima1zumi/gists{/gist_id}
  gravatar_id: ''
  html_url: https://github.com/ima1zumi
  id: 52617472
  login: ima1zumi
  node_id: MDQ6VXNlcjUyNjE3NDcy
  organizations_url: https://api.github.com/users/ima1zumi/orgs
  received_events_url: https://api.github.com/users/ima1zumi/received_events
  repos_url: https://api.github.com/users/ima1zumi/repos
  site_admin: false
  starred_url: https://api.github.com/users/ima1zumi/starred{/owner}{/repo}
  subscriptions_url: https://api.github.com/users/ima1zumi/subscriptions
  type: User
  url: https://api.github.com/users/ima1zumi

---
encode が1万回走る場合: 

文字数は同じ

`GC.disable; 10000.times { ("あ,あ,あ,あ,あ,"*10).encode(Encoding::CP932).split(",", -1) }`

```
vagrant@ubuntu-bionic:~$ sudo perf record -g ~/workdir/install_optimized/bin/ruby-optimized -e 'GC.disable; 10000.times { ("あ,あ,あ,あ,あ,"*10).encode(Encoding::CP932).split(",", -1) }'
[ perf record: Woken up 1 times to write data ]
[ perf record: Captured and wrote 0.094 MB perf.data (233 samples) ]
vagrant@ubuntu-bionic:~$ sudo perf report --no-children
Samples: 233  of event 'cpu-clock', Event count (approx.): 58250000
  Overhead  Command         Shared Object       Symbol
+    4.72%  ruby-optimized  ruby-optimized      [.] ruby_yyparse
+    3.86%  ruby-optimized  ruby-optimized      [.] transcode_restartable0
+    3.00%  ruby-optimized  ruby-optimized      [.] ruby_sip_hash13
+    3.00%  ruby-optimized  ruby-optimized      [.] str_new0
+    2.15%  ruby-optimized  libc-2.27.so        [.] _int_malloc
+    2.15%  ruby-optimized  ruby-optimized      [.] get_bin
+    1.72%  ruby-optimized  ruby-optimized      [.] enc_from_index
+    1.29%  ruby-optimized  ruby-optimized      [.] RB_FL_ANY_RAW
+    1.29%  ruby-optimized  ruby-optimized      [.] RB_FL_TEST_RAW
+    1.29%  ruby-optimized  ruby-optimized      [.] RVALUE_OLD_P_RAW
+    1.29%  ruby-optimized  ruby-optimized      [.] newobj_alloc
+    1.29%  ruby-optimized  ruby-optimized      [.] newobj_init
+    1.29%  ruby-optimized  ruby-optimized      [.] ractor_cache_allocate_slot
+    1.29%  ruby-optimized  ruby-optimized      [.] rb_ary_push
+    1.29%  ruby-optimized  ruby-optimized      [.] rb_st_lookup
+    1.29%  ruby-optimized  ruby-optimized      [.] rbimpl_rstring_getmem
+    0.86%  ruby-optimized  [kernel.kallsyms]   [k] clear_page_rep
+    0.86%  ruby-optimized  ruby-optimized      [.] RB_BUILTIN_TYPE
+    0.86%  ruby-optimized  ruby-optimized      [.] RB_SPECIAL_CONST_P
+    0.86%  ruby-optimized  ruby-optimized      [.] RB_TEST
+    0.86%  ruby-optimized  ruby-optimized      [.] RVALUE_FLAGS_AGE_SET
+    0.86%  ruby-optimized  ruby-optimized      [.] find_table_entry_ind
+    0.86%  ruby-optimized  ruby-optimized      [.] newobj_of0
+    0.86%  ruby-optimized  ruby-optimized      [.] nextc
+    0.86%  ruby-optimized  ruby-optimized      [.] rb_enc_from_index
+    0.86%  ruby-optimized  ruby-optimized      [.] rb_vm_lock_enter
+    0.86%  ruby-optimized  ruby-optimized      [.] rbimpl_fl_set_raw_raw
+    0.86%  ruby-optimized  ruby-optimized      [.] search_nonascii
+    0.86%  ruby-optimized  ruby-optimized      [.] str_alloc
+    0.86%  ruby-optimized  ruby-optimized      [.] vm_call_cfunc_with_frame
+    0.86%  ruby-optimized  windows_31j.so      [.] left_adjust_char_head
     0.43%  ruby-optimized  [kernel.kallsyms]   [k] __do_page_fault
     0.43%  ruby-optimized  [kernel.kallsyms]   [k] _raw_spin_lock
     0.43%  ruby-optimized  [kernel.kallsyms]   [k] _raw_spin_unlock_irqrestore
     0.43%  ruby-optimized  [kernel.kallsyms]   [k] flush_tlb_mm_range
     0.43%  ruby-optimized  [kernel.kallsyms]   [k] memset
     0.43%  ruby-optimized  [kernel.kallsyms]   [k] page_remove_rmap
     0.43%  ruby-optimized  [kernel.kallsyms]   [k] rw_verify_area
     0.43%  ruby-optimized  [kernel.kallsyms]   [k] strncpy_from_user
     0.43%  ruby-optimized  [kernel.kallsyms]   [k] tlb_finish_mmu
     0.43%  ruby-optimized  [kernel.kallsyms]   [k] unmap_page_range
     0.43%  ruby-optimized  [kernel.kallsyms]   [k] vma_compute_subtree_gap
     0.43%  ruby-optimized  ld-2.27.so          [.] _dl_cache_libcmp
     0.43%  ruby-optimized  libc-2.27.so        [.] __memchr_avx2
     0.43%  ruby-optimized  libc-2.27.so        [.] __memcpy_avx_unaligned_erms
     0.43%  ruby-optimized  libc-2.27.so        [.] __memset_avx2_unaligned
     0.43%  ruby-optimized  libc-2.27.so        [.] cfree@GLIBC_2.2.5
     0.43%  ruby-optimized  libc-2.27.so        [.] getgid
     0.43%  ruby-optimized  libc-2.27.so        [.] handle_intel.constprop.1
     0.43%  ruby-optimized  libc-2.27.so        [.] malloc_usable_size
     0.43%  ruby-optimized  libc-2.27.so        [.] munmap
     0.43%  ruby-optimized  libpthread-2.27.so  [.] pthread_mutex_unlock
     0.43%  ruby-optimized  ruby-optimized      [.] RBASIC_CLASS
     0.43%  ruby-optimized  ruby-optimized      [.] RBASIC_SET_CLASS_RAW
     0.43%  ruby-optimized  ruby-optimized      [.] RB_BUILTIN_TYPE
     0.43%  ruby-optimized  ruby-optimized      [.] RB_BUILTIN_TYPE
     0.43%  ruby-optimized  ruby-optimized      [.] RB_BUILTIN_TYPE
     0.43%  ruby-optimized  ruby-optimized      [.] RB_BUILTIN_TYPE
     0.43%  ruby-optimized  ruby-optimized      [.] RB_ENCODING_GET
     0.43%  ruby-optimized  ruby-optimized      [.] RB_ENCODING_GET_INLINED
     0.43%  ruby-optimized  ruby-optimized      [.] RB_ENCODING_SET_INLINED
     0.43%  ruby-optimized  ruby-optimized      [.] RB_ENC_CODERANGE
     0.43%  ruby-optimized  ruby-optimized      [.] RB_ENC_CODERANGE_SET
     0.43%  ruby-optimized  ruby-optimized      [.] RB_FL_ANY_RAW
     0.43%  ruby-optimized  ruby-optimized      [.] RB_FL_TEST_RAW
     0.43%  ruby-optimized  ruby-optimized      [.] RB_FL_TEST_RAW
     0.43%  ruby-optimized  ruby-optimized      [.] RB_IMMEDIATE_P
     0.43%  ruby-optimized  ruby-optimized      [.] RB_IMMEDIATE_P
     0.43%  ruby-optimized  ruby-optimized      [.] RB_IMMEDIATE_P
     0.43%  ruby-optimized  ruby-optimized      [.] RB_IMMEDIATE_P
     0.43%  ruby-optimized  ruby-optimized      [.] RB_OBJ_FROZEN
     0.43%  ruby-optimized  ruby-optimized      [.] RB_OBJ_FROZEN
     0.43%  ruby-optimized  ruby-optimized      [.] RB_SPECIAL_CONST_P
     0.43%  ruby-optimized  ruby-optimized      [.] RB_SPECIAL_CONST_P
     0.43%  ruby-optimized  ruby-optimized      [.] RB_TEST
     0.43%  ruby-optimized  ruby-optimized      [.] RB_TYPE_P
     0.43%  ruby-optimized  ruby-optimized      [.] RHASH_ST_TABLE_P
     0.43%  ruby-optimized  ruby-optimized      [.] RSTRING_EMBED_LEN
     0.43%  ruby-optimized  ruby-optimized      [.] RSTRING_END
     0.43%  ruby-optimized  ruby-optimized      [.] RSTRING_PTR
```