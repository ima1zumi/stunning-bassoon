---
author_association: OWNER
created_at: '2022-06-19T13:02:06Z'
html_url: https://github.com/ima1zumi/stunning-bassoon/issues/9#issuecomment-1159720678
id: 1159720678
issue_url: https://api.github.com/repos/ima1zumi/stunning-bassoon/issues/9
node_id: IC_kwDOHe_Pp85FH-7m
performed_via_github_app: 
reactions:
  "+1": 0
  "-1": 0
  confused: 0
  eyes: 0
  heart: 0
  hooray: 0
  laugh: 0
  rocket: 0
  total_count: 0
  url: https://api.github.com/repos/ima1zumi/stunning-bassoon/issues/comments/1159720678/reactions
updated_at: '2022-06-19T13:03:56Z'
url: https://api.github.com/repos/ima1zumi/stunning-bassoon/issues/comments/1159720678
user:
  avatar_url: https://avatars.githubusercontent.com/u/52617472?v=4
  events_url: https://api.github.com/users/ima1zumi/events{/privacy}
  followers_url: https://api.github.com/users/ima1zumi/followers
  following_url: https://api.github.com/users/ima1zumi/following{/other_user}
  gists_url: https://api.github.com/users/ima1zumi/gists{/gist_id}
  gravatar_id: ''
  html_url: https://github.com/ima1zumi
  id: 52617472
  login: ima1zumi
  node_id: MDQ6VXNlcjUyNjE3NDcy
  organizations_url: https://api.github.com/users/ima1zumi/orgs
  received_events_url: https://api.github.com/users/ima1zumi/received_events
  repos_url: https://api.github.com/users/ima1zumi/repos
  site_admin: false
  starred_url: https://api.github.com/users/ima1zumi/starred{/owner}{/repo}
  subscriptions_url: https://api.github.com/users/ima1zumi/subscriptions
  type: User
  url: https://api.github.com/users/ima1zumi

---
encode が 10万回走る場合: 

`GC.disable; 100000.times { "あ,あ,あ,あ,あ,".encode(Encoding::CP932).split(",", -1) }`

```bash
vagrant@ubuntu-bionic:~$ sudo perf record -g ~/workdir/install_optimized/bin/ruby-optimized -e 'GC.disable; 100000.times { "あ,あ,あ,あ,あ,".encode(Encoding::CP932).split(",", -1) }'
[ perf record: Woken up 1 times to write data ]
[ perf record: Captured and wrote 0.150 MB perf.data (398 samples) ]
vagrant@ubuntu-bionic:~$ sudo perf report --no-children
Samples: 398  of event 'cpu-clock', Event count (approx.): 99500000
  Overhead  Command         Shared Object      Symbol
+    5.03%  ruby-optimized  ruby-optimized     [.] transcode_restartable0
+    3.27%  ruby-optimized  ruby-optimized     [.] RB_FL_TEST_RAW
+    2.51%  ruby-optimized  ruby-optimized     [.] ruby_yyparse
+    2.51%  ruby-optimized  ruby-optimized     [.] strcasehash
+    2.01%  ruby-optimized  ruby-optimized     [.] enc_from_index
+    2.01%  ruby-optimized  ruby-optimized     [.] rbimpl_atomic_size_cas
+    1.51%  ruby-optimized  ruby-optimized     [.] RSTRING_PTR
+    1.51%  ruby-optimized  ruby-optimized     [.] atomic_sub_nounderflow
+    1.26%  ruby-optimized  ruby-optimized     [.] search_nonascii
+    1.26%  ruby-optimized  ruby-optimized     [.] vm_call_cfunc_with_frame
+    1.26%  ruby-optimized  ruby-optimized     [.] vm_exec_core
+    1.01%  ruby-optimized  ruby-optimized     [.] heap_page_add_freeobj
+    1.01%  ruby-optimized  ruby-optimized     [.] newobj_alloc
+    1.01%  ruby-optimized  ruby-optimized     [.] objspace_xfree
+    1.01%  ruby-optimized  ruby-optimized     [.] rb_gc_obj_slot_size
+    1.01%  ruby-optimized  ruby-optimized     [.] rb_st_locale_insensitive_strcasecmp
+    1.01%  ruby-optimized  ruby-optimized     [.] rbimpl_atomic_size_add
+    1.01%  ruby-optimized  ruby-optimized     [.] rbimpl_rstring_getmem
+    1.01%  ruby-optimized  ruby-optimized     [.] size_pool_slot_size
+    1.01%  ruby-optimized  windows_31j.so     [.] left_adjust_char_head
+    0.75%  ruby-optimized  [kernel.kallsyms]  [k] __softirqentry_text_start
+    0.75%  ruby-optimized  libc-2.27.so       [.] cfree@GLIBC_2.2.5
+    0.75%  ruby-optimized  ruby-optimized     [.] RB_ENCODING_SET_INLINED
+    0.75%  ruby-optimized  ruby-optimized     [.] find_table_entry_ind
+    0.75%  ruby-optimized  ruby-optimized     [.] invoke_block_from_c_bh
+    0.75%  ruby-optimized  ruby-optimized     [.] newobj_init
+    0.75%  ruby-optimized  ruby-optimized     [.] newobj_of
+    0.75%  ruby-optimized  ruby-optimized     [.] objspace_xmalloc0
+    0.75%  ruby-optimized  ruby-optimized     [.] onigenc_unicode_is_code_ctype
+    0.75%  ruby-optimized  ruby-optimized     [.] rb_ec_ractor_ptr
+    0.75%  ruby-optimized  ruby-optimized     [.] rb_enc_from_index
+    0.75%  ruby-optimized  ruby-optimized     [.] rb_enc_get_index
+    0.75%  ruby-optimized  ruby-optimized     [.] rb_scan_args_assign
+    0.75%  ruby-optimized  ruby-optimized     [.] str_new0
+    0.75%  ruby-optimized  ruby-optimized     [.] vm_push_frame
+    0.50%  ruby-optimized  [kernel.kallsyms]  [k] __do_page_fault
+    0.50%  ruby-optimized  [kernel.kallsyms]  [k] _raw_spin_lock
+    0.50%  ruby-optimized  [kernel.kallsyms]  [k] _raw_spin_unlock_irqrestore
+    0.50%  ruby-optimized  [kernel.kallsyms]  [k] try_charge
+    0.50%  ruby-optimized  libc-2.27.so       [.] __libc_malloc
+    0.50%  ruby-optimized  libc-2.27.so       [.] _int_malloc
+    0.50%  ruby-optimized  libc-2.27.so       [.] malloc_usable_size
+    0.50%  ruby-optimized  ruby-optimized     [.] RB_BUILTIN_TYPE
+    0.50%  ruby-optimized  ruby-optimized     [.] RB_ENCODING_GET
+    0.50%  ruby-optimized  ruby-optimized     [.] RB_ENCODING_GET_INLINED
+    0.50%  ruby-optimized  ruby-optimized     [.] RB_ENC_CODERANGE
+    0.50%  ruby-optimized  ruby-optimized     [.] RB_FL_TEST_RAW
+    0.50%  ruby-optimized  ruby-optimized     [.] RB_OBJ_FROZEN
+    0.50%  ruby-optimized  ruby-optimized     [.] RB_SPECIAL_CONST_P
+    0.50%  ruby-optimized  ruby-optimized     [.] RB_SPECIAL_CONST_P
+    0.50%  ruby-optimized  ruby-optimized     [.] RB_TEST
+    0.50%  ruby-optimized  ruby-optimized     [.] RSTRING_LEN
+    0.50%  ruby-optimized  ruby-optimized     [.] RUBY_VM_INTERRUPTED_ANY
+    0.50%  ruby-optimized  ruby-optimized     [.] ary_resize_capa
+    0.50%  ruby-optimized  ruby-optimized     [.] do_hash
+    0.50%  ruby-optimized  ruby-optimized     [.] get_bin
+    0.50%  ruby-optimized  ruby-optimized     [.] newobj_fill
+    0.50%  ruby-optimized  ruby-optimized     [.] newobj_of0
+    0.50%  ruby-optimized  ruby-optimized     [.] nlz_int64
+    0.50%  ruby-optimized  ruby-optimized     [.] ractor_cache_allocate_slot
+    0.50%  ruby-optimized  ruby-optimized     [.] ractor_safe_call_cfunc_m1
+    0.50%  ruby-optimized  ruby-optimized     [.] rb_array_len
+    0.50%  ruby-optimized  ruby-optimized     [.] rb_st_lookup
+    0.50%  ruby-optimized  ruby-optimized     [.] rb_str_subseq
+    0.50%  ruby-optimized  ruby-optimized     [.] rbimpl_rstring_getmem
+    0.50%  ruby-optimized  ruby-optimized     [.] ruby_sized_xfree
+    0.50%  ruby-optimized  ruby-optimized     [.] ruby_xmalloc0
+    0.50%  ruby-optimized  ruby-optimized     [.] str_embed_size
+    0.50%  ruby-optimized  ruby-optimized     [.] transcode_loop
+    0.50%  ruby-optimized  ruby-optimized     [.] transcode_search_path
+    0.50%  ruby-optimized  ruby-optimized     [.] vm_ci_argc
+    0.50%  ruby-optimized  windows_31j.so     [.] mbc_enc_len
     0.25%  ruby-optimized  [kernel.kallsyms]  [k] filemap_map_pages
     0.25%  ruby-optimized  [kernel.kallsyms]  [k] finish_task_switch
     0.25%  ruby-optimized  [kernel.kallsyms]  [k] flush_tlb_mm_range
     0.25%  ruby-optimized  [kernel.kallsyms]  [k] get_page_from_freelist
     0.25%  ruby-optimized  [kernel.kallsyms]  [k] sys_mmap_pgoff
     0.25%  ruby-optimized  [kernel.kallsyms]  [k] vm_mmap_pgoff
     0.25%  ruby-optimized  libc-2.27.so       [.] malloc_consolidate
     0.25%  ruby-optimized  ruby-optimized     [.] BSD_vfprintf
```