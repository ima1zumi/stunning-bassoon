---
author_association: OWNER
created_at: '2022-06-19T13:08:35Z'
html_url: https://github.com/ima1zumi/stunning-bassoon/issues/9#issuecomment-1159722257
id: 1159722257
issue_url: https://api.github.com/repos/ima1zumi/stunning-bassoon/issues/9
node_id: IC_kwDOHe_Pp85FH_UR
performed_via_github_app: 
reactions:
  "+1": 0
  "-1": 0
  confused: 0
  eyes: 0
  heart: 0
  hooray: 0
  laugh: 0
  rocket: 0
  total_count: 0
  url: https://api.github.com/repos/ima1zumi/stunning-bassoon/issues/comments/1159722257/reactions
updated_at: '2022-06-19T13:08:35Z'
url: https://api.github.com/repos/ima1zumi/stunning-bassoon/issues/comments/1159722257
user:
  avatar_url: https://avatars.githubusercontent.com/u/52617472?v=4
  events_url: https://api.github.com/users/ima1zumi/events{/privacy}
  followers_url: https://api.github.com/users/ima1zumi/followers
  following_url: https://api.github.com/users/ima1zumi/following{/other_user}
  gists_url: https://api.github.com/users/ima1zumi/gists{/gist_id}
  gravatar_id: ''
  html_url: https://github.com/ima1zumi
  id: 52617472
  login: ima1zumi
  node_id: MDQ6VXNlcjUyNjE3NDcy
  organizations_url: https://api.github.com/users/ima1zumi/orgs
  received_events_url: https://api.github.com/users/ima1zumi/received_events
  repos_url: https://api.github.com/users/ima1zumi/repos
  site_admin: false
  starred_url: https://api.github.com/users/ima1zumi/starred{/owner}{/repo}
  subscriptions_url: https://api.github.com/users/ima1zumi/subscriptions
  type: User
  url: https://api.github.com/users/ima1zumi

---
GCも外した

```bash
agrant@ubuntu-bionic:~$ sudo perf record -g ~/workdir/install_optimized/bin/ruby-optimized -e '100000.times { "あいうえおかきくけこ".encode(Encoding::CP932) }'
[ perf record: Woken up 1 times to write data ]
[ perf record: Captured and wrote 0.097 MB perf.data (219 samples) ]
vagrant@ubuntu-bionic:~$ sudo perf report --no-children

Samples: 219  of event 'cpu-clock', Event count (approx.): 54750000
  Overhead  Command         Shared Object      Symbol
+    5.94%  ruby-optimized  ruby-optimized     [.] transcode_restartable0
+    3.20%  ruby-optimized  ruby-optimized     [.] ruby_yyparse
+    2.74%  ruby-optimized  ruby-optimized     [.] rbimpl_atomic_size_add
+    2.28%  ruby-optimized  ruby-optimized     [.] rbimpl_atomic_size_cas
+    1.83%  ruby-optimized  ruby-optimized     [.] do_hash
+    1.83%  ruby-optimized  ruby-optimized     [.] objspace_malloc_increase_body
+    1.83%  ruby-optimized  ruby-optimized     [.] vm_exec_core
+    1.37%  ruby-optimized  ruby-optimized     [.] ractor_cache_allocate_slot
+    1.37%  ruby-optimized  ruby-optimized     [.] rb_enc_from_index
+    1.37%  ruby-optimized  ruby-optimized     [.] rb_vm_exec
+    0.91%  ruby-optimized  libc-2.27.so       [.] __libc_malloc
+    0.91%  ruby-optimized  ruby-optimized     [.] RB_BUILTIN_TYPE
+    0.91%  ruby-optimized  ruby-optimized     [.] RB_ENC_CODERANGE
+    0.91%  ruby-optimized  ruby-optimized     [.] RB_FL_TEST_RAW
+    0.91%  ruby-optimized  ruby-optimized     [.] RB_INT2FIX
+    0.91%  ruby-optimized  ruby-optimized     [.] RB_TYPE_P
+    0.91%  ruby-optimized  ruby-optimized     [.] RVALUE_WB_UNPROTECTED
+    0.91%  ruby-optimized  ruby-optimized     [.] VM_ENV_LOCAL_P
+    0.91%  ruby-optimized  ruby-optimized     [.] get_bin
+    0.91%  ruby-optimized  ruby-optimized     [.] heap_page_add_freeobj
+    0.91%  ruby-optimized  ruby-optimized     [.] invoke_block_from_c_bh
+    0.91%  ruby-optimized  ruby-optimized     [.] is_identchar
+    0.91%  ruby-optimized  ruby-optimized     [.] nextc
+    0.91%  ruby-optimized  ruby-optimized     [.] parser_yylex
+    0.91%  ruby-optimized  ruby-optimized     [.] rb_ec_ractor_hooks
+    0.91%  ruby-optimized  ruby-optimized     [.] rb_econv_close
+    0.91%  ruby-optimized  ruby-optimized     [.] rb_enc_get_index
+    0.91%  ruby-optimized  ruby-optimized     [.] rb_multi_ractor_p
+    0.91%  ruby-optimized  ruby-optimized     [.] rb_obj_class
+    0.91%  ruby-optimized  ruby-optimized     [.] rb_str_set_len
+    0.91%  ruby-optimized  ruby-optimized     [.] rbimpl_size_mul_overflow
+    0.91%  ruby-optimized  ruby-optimized     [.] size_pool_idx_for_size
+    0.91%  ruby-optimized  ruby-optimized     [.] strcasehash
     0.46%  ruby-optimized  [kernel.kallsyms]  [k] __do_page_fault
     0.46%  ruby-optimized  [kernel.kallsyms]  [k] __softirqentry_text_start
     0.46%  ruby-optimized  [kernel.kallsyms]  [k] clear_page_rep
     0.46%  ruby-optimized  [kernel.kallsyms]  [k] do_syscall_64
     0.46%  ruby-optimized  [kernel.kallsyms]  [k] get_page_from_freelist
     0.46%  ruby-optimized  [kernel.kallsyms]  [k] security_inode_getattr
     0.46%  ruby-optimized  libc-2.27.so       [.] __memcpy_avx_unaligned_erms
     0.46%  ruby-optimized  libc-2.27.so       [.] cfree@GLIBC_2.2.5
     0.46%  ruby-optimized  libc-2.27.so       [.] malloc_consolidate
     0.46%  ruby-optimized  libc-2.27.so       [.] malloc_usable_size
     0.46%  ruby-optimized  ruby-optimized     [.] RARRAY_ASET
     0.46%  ruby-optimized  ruby-optimized     [.] RB_BUILTIN_TYPE
     0.46%  ruby-optimized  ruby-optimized     [.] RB_BUILTIN_TYPE
     0.46%  ruby-optimized  ruby-optimized     [.] RB_BUILTIN_TYPE
     0.46%  ruby-optimized  ruby-optimized     [.] RB_ENCODING_GET_INLINED
     0.46%  ruby-optimized  ruby-optimized     [.] RB_FL_ANY_RAW
     0.46%  ruby-optimized  ruby-optimized     [.] RB_FL_ANY_RAW
     0.46%  ruby-optimized  ruby-optimized     [.] RB_FL_TEST
     0.46%  ruby-optimized  ruby-optimized     [.] RB_FL_TEST
     0.46%  ruby-optimized  ruby-optimized     [.] RB_FL_TEST_RAW
     0.46%  ruby-optimized  ruby-optimized     [.] RB_FL_TEST_RAW
     0.46%  ruby-optimized  ruby-optimized     [.] RB_FL_TEST_RAW
     0.46%  ruby-optimized  ruby-optimized     [.] RB_FL_TEST_RAW
     0.46%  ruby-optimized  ruby-optimized     [.] RB_FL_UNSET_RAW
     0.46%  ruby-optimized  ruby-optimized     [.] RB_IMMEDIATE_P
     0.46%  ruby-optimized  ruby-optimized     [.] RB_IMMEDIATE_P
     0.46%  ruby-optimized  ruby-optimized     [.] RB_IMMEDIATE_P
     0.46%  ruby-optimized  ruby-optimized     [.] RB_IMMEDIATE_P
     0.46%  ruby-optimized  ruby-optimized     [.] RB_NIL_P
     0.46%  ruby-optimized  ruby-optimized     [.] RB_SPECIAL_CONST_P
     0.46%  ruby-optimized  ruby-optimized     [.] RB_SPECIAL_CONST_P
     0.46%  ruby-optimized  ruby-optimized     [.] RB_SPECIAL_CONST_P
     0.46%  ruby-optimized  ruby-optimized     [.] RB_STATIC_SYM_P
     0.46%  ruby-optimized  ruby-optimized     [.] RB_TEST
     0.46%  ruby-optimized  ruby-optimized     [.] RSTRING_LEN
     0.46%  ruby-optimized  ruby-optimized     [.] RSTRING_PTR
     0.46%  ruby-optimized  ruby-optimized     [.] RSTRING_PTR
     0.46%  ruby-optimized  ruby-optimized     [.] RVALUE_OLD_P
     0.46%  ruby-optimized  ruby-optimized     [.] RVALUE_OLD_P_RAW
     0.46%  ruby-optimized  ruby-optimized     [.] RVALUE_PAGE_OLD_UNCOLLECTIBLE_SET
     0.46%  ruby-optimized  ruby-optimized     [.] VM_ENV_FLAGS
     0.46%  ruby-optimized  ruby-optimized     [.] VM_EP_LEP
     0.46%  ruby-optimized  ruby-optimized     [.] ary_memcpy0
     0.46%  ruby-optimized  ruby-optimized     [.] assignable
     0.46%  ruby-optimized  ruby-optimized     [.] atomic_sub_nounderflow
     0.46%  ruby-optimized  ruby-optimized     [.] attr_leaf_opt_send_without_block
     0.46%  ruby-optimized  ruby-optimized     [.] callable_method_entry
```